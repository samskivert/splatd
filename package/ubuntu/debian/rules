#!/usr/bin/make -f
# Based on the sample rules file generated by dh_make.

PYVERS=$(shell pyversions -vr)

build: $(PYVERS:%=build-python%)
	touch $@

build-python%:
	dh_testdir
	# Build the python modules.
	python$* setup.py build
	touch $@

clean:
	dh_testdir
	dh_testroot
	rm -f build-stamp

	# Clean up after the build process.
	python$* setup.py clean
	rm -rf build
	rm -f splat/__init__.pyc

	dh_clean 
	debconf-updatepo

install: build $(PYVERS:%=install-python%)

install-python%:
	dh_testdir
	dh_testroot
	dh_clean -k 
	dh_installdirs

	# Install the package into debian/splatd.
	python$* setup.py install --root=$(CURDIR)/debian/splatd --install-scripts=/usr/sbin

	# Install configuration file template for postinst script
	install -m 0644 debian/splat.conf.in debian/splatd/usr/share/splatd/splat.conf.in

# Build architecture-dependent files here.
binary-arch: build install
# We have nothing to do by default.

# Build architecture-independent files here.
binary-indep: build install
	dh_testdir
	dh_testroot
	dh_installchangelogs 
	# Install splat manual
	cp -a docs/xhtml/* debian/splatd/usr/share/doc/splatd/html/
	dh_installdocs
	dh_installexamples splat.conf
	dh_installman
	dh_installdebconf
	dh_pycentral
	dh_installinit
	dh_compress -X.py
	dh_fixperms
	dh_installdeb
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install
